{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\Glorison Lai\\\\Documents\\\\GitHub\\\\weatherapp\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\Glorison Lai\\\\Documents\\\\GitHub\\\\weatherapp\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:\\\\Users\\\\Glorison Lai\\\\Documents\\\\GitHub\\\\weatherapp\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import _toConsumableArray from\"C:\\\\Users\\\\Glorison Lai\\\\Documents\\\\GitHub\\\\weatherapp\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import React,{useState,useReducer,useEffect}from'react';import Card from'./card/card';import Services from'../../services/services';var reducer=function reducer(list,action){var type=action.type,data=action.data,index=action.index;switch(type){case'ADD_CARD':return index<list.length?[].concat(_toConsumableArray(list.slice(0,index)),_toConsumableArray(data),_toConsumableArray(list.slice(index+1))):list.concat(data);case'REMOVE_CARD':return list.filter(function(_,i){return i!==index;});default:return data;}};var CardRow=function CardRow(){var _useReducer=useReducer(reducer,[]),_useReducer2=_slicedToArray(_useReducer,2),idList=_useReducer2[0],changeIdList=_useReducer2[1];var _useState=useState({startX:null,startScrollX:null}),_useState2=_slicedToArray(_useState,2),scrollX=_useState2[0],updateScrollX=_useState2[1];var savedList=JSON.parse(window.localStorage.getItem('saved-ids'));useEffect(function(){if(!savedList||!savedList.length)return;var saveWeather=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var validIds,dataList;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:validIds=savedList.filter(function(id){return typeof id=='number';});_context.next=3;return Promise.all(validIds.map(function(id){return Services.getWeather({locId:id});}));case 3:dataList=_context.sent;changeIdList({type:'REPLACE',data:dataList});case 5:case\"end\":return _context.stop();}}},_callee);}));return function saveWeather(){return _ref.apply(this,arguments);};}();saveWeather();changeIdList({type:'REPLACE',data:savedList});},[]);useEffect(function(){window.localStorage.setItem('saved-ids',JSON.stringify(idList.map(function(data){return data.id;})));},[idList]);var handleChange=function handleChange(_ref2){var data=_ref2.data,index=_ref2.index;changeIdList({type:!!data?'ADD_CARD':'REMOVE_CARD',data:[data],index:index});};// Click to scroll\nvar handleMouseMove=function handleMouseMove(_ref3){var clientX=_ref3.clientX;var startX=scrollX.startX,startScrollX=scrollX.startScrollX;var newX=startScrollX-clientX+startX;window.scrollTo(newX,0);var windowScrollX=window.scrollX;if(newX!==window.scrollX){updateScrollX({startX:clientX+windowScrollX-startScrollX,startScrollX:startScrollX});}};var handleMouseUp=function handleMouseUp(){if(scrollX.startX){window.removeEventListener('mousemove',handleMouseMove);window.removeEventListener('mouseup',handleMouseUp);updateScrollX({startX:null,startScrollX:null});}};var handleMouseDown=function handleMouseDown(_ref4){var target=_ref4.target,clientX=_ref4.clientX;if(target.className!=='card-row body')return;window.addEventListener('onmousemove',handleMouseMove);window.addEventListener('mouseup',handleMouseUp);updateScrollX({startX:clientX,startScrollX:window.scrollX});};return/*#__PURE__*/React.createElement(\"div\",{className:\"card-row body\",onMouseDown:handleMouseDown},idList.length>0&&idList.map(function(data,index){return/*#__PURE__*/React.createElement(Card,{initData:data,index:index,onChange:function onChange(payload){return handleChange(payload);}});}),idList.length<10&&/*#__PURE__*/React.createElement(Card,{onChange:function onChange(payload){return handleChange(payload);}}),/*#__PURE__*/React.createElement(\"div\",{className:\"placeholder\"}));};export default CardRow;","map":{"version":3,"sources":["C:/Users/Glorison Lai/Documents/GitHub/weatherapp/client/src/components/util/card-row.jsx"],"names":["React","useState","useReducer","useEffect","Card","Services","reducer","list","action","type","data","index","length","slice","concat","filter","_","i","CardRow","idList","changeIdList","startX","startScrollX","scrollX","updateScrollX","savedList","JSON","parse","window","localStorage","getItem","saveWeather","validIds","id","Promise","all","map","getWeather","locId","dataList","setItem","stringify","handleChange","handleMouseMove","clientX","newX","scrollTo","windowScrollX","handleMouseUp","removeEventListener","handleMouseDown","target","className","addEventListener","payload"],"mappings":"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","sourcesContent":["import React, {useState, useReducer, useEffect} from 'react';\r\nimport Card from './card/card';\r\nimport Services from '../../services/services';\r\n\r\nconst reducer = (list, action) => {\r\n  const {type, data, index} = action;\r\n  switch (type) {\r\n    case 'ADD_CARD':\r\n      return( index < list.length ? [...list.slice(0,index), ...data, ...list.slice(index+1)] : list.concat(data));\r\n    case 'REMOVE_CARD':\r\n      return(list.filter((_,i) => i !== index));\r\n    default:\r\n      return data;\r\n  }\r\n}\r\n\r\nconst CardRow = () => {\r\n  const [idList, changeIdList] = useReducer(reducer, []);\r\n  const [scrollX, updateScrollX] = useState({\r\n    startX: null, \r\n    startScrollX: null\r\n  });\r\n  const savedList = JSON.parse(window.localStorage.getItem('saved-ids'));\r\n\r\n  useEffect(() => {\r\n    if (!savedList || !savedList.length) return;\r\n    \r\n    const saveWeather = async () => {\r\n      const validIds = savedList.filter(id => typeof(id) == 'number');\r\n      const dataList = await Promise.all(validIds.map((id) => Services.getWeather({locId: id})));\r\n      changeIdList({type: 'REPLACE', data: dataList});\r\n    };\r\n\r\n    saveWeather();\r\n    changeIdList({type: 'REPLACE', data: savedList});\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    window.localStorage.setItem('saved-ids', JSON.stringify(idList.map((data) => data.id)));\r\n  }, [idList]);\r\n\r\n  const handleChange = ({data, index}) => {\r\n    changeIdList({\r\n      type: !!data ? 'ADD_CARD' : 'REMOVE_CARD',\r\n      data: [data],\r\n      index: index,\r\n    });\r\n  };\r\n\r\n  // Click to scroll\r\n  const handleMouseMove = ({clientX}) => {\r\n    const {startX, startScrollX} = scrollX;\r\n    const newX = startScrollX - clientX + startX;\r\n    window.scrollTo(newX, 0);\r\n    const windowScrollX = window.scrollX;\r\n    if (newX !== window.scrollX) {\r\n      updateScrollX({\r\n        startX: clientX + windowScrollX - startScrollX,\r\n        startScrollX: startScrollX,\r\n      });\r\n    }\r\n  };\r\n\r\n  const handleMouseUp = () => {\r\n    if (scrollX.startX) {\r\n      window.removeEventListener('mousemove', handleMouseMove);\r\n      window.removeEventListener('mouseup', handleMouseUp);\r\n      updateScrollX({startX: null, startScrollX: null});\r\n    }\r\n  }\r\n\r\n  const handleMouseDown = ({target, clientX}) => {\r\n    if (target.className !== 'card-row body') return;\r\n    window.addEventListener('onmousemove', handleMouseMove);\r\n    window.addEventListener('mouseup', handleMouseUp);\r\n    updateScrollX({\r\n      startX: clientX, \r\n      startScrollX: window.scrollX,\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div \r\n      className=\"card-row body\"\r\n      onMouseDown={handleMouseDown}\r\n    >\r\n      {idList.length > 0 && \r\n        idList.map((data, index) => <Card initData={data} index={index} onChange={(payload) => handleChange(payload)}/>\r\n        )\r\n      }\r\n      {idList.length < 10 &&\r\n        <Card onChange={(payload) => handleChange(payload)}/>\r\n      }\r\n      <div className=\"placeholder\"/>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CardRow;"]},"metadata":{},"sourceType":"module"}